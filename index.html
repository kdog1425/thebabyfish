<!DOCTYPE html>
<html lang="en">
  <head>
    <title>obj tester</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
      body {
        background:#fff;
        padding:0;
        margin:0;
        overflow:hidden;
        font-family:georgia;
        text-align:center;
      }
    </style>
  </head>
 
  <body>
 
    <script src="three.min.js"></script>
    <script src="js/loaders/DDSLoader.js"></script>
    <script src="js/loaders/MTLLoader.js"></script>
    <script src="js/loaders/OBJMTLLoader.js"></script>
 
    <script>
 
      var SCREEN_WIDTH = window.innerWidth;
      var SCREEN_HEIGHT = window.innerHeight;
 
      var container;
 
      var camera, scene;
      var canvasRenderer, webglRenderer;
 
      var mesh, zmesh, geometry;
 
      var windowHalfX = window.innerWidth / 2;
      var windowHalfY = window.innerHeight / 2;
 
      var meshes = [];
      var mouseX = 0, mouseY = 0;
      var rotation = 0;
      var SEPARATION     = 5;
      var WAVE_HEIGHT    = 10;
      var WAVE_SPEED     = 0.2;
      var ROTATION_SPEED = 0.05;
      var DAMP_SPEED     = 0.005;
      var factor = 1.0;
      var points = [];
      var boxes = [];
      var val = 6.20 / 2016;
      var audio;

      init();
      animate();
      
      function playSound(){
        audio = document.createElement('audio');
        var source = document.createElement('source');
        source.src = 'sounds/baby.mp3';
        audio.appendChild(source);
        audio.play();
      }
 
      function init() {
 
        container = document.createElement('div');
        document.body.appendChild(container);
 
        camera = new THREE.PerspectiveCamera(45, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 100000);
        camera.position.x = -250;
        camera.position.y = 0;
        camera.position.z = 500;
       
        scene = new THREE.Scene();
 
        // LIGHTS
        var ambient = new THREE.AmbientLight(0x666666);
        scene.add(ambient);
 
        var directionalLight = new THREE.DirectionalLight(0xffeedd);
        directionalLight.position.set(0, 70, 100).normalize();
        scene.add(directionalLight);

        // SKYBOX
        var imagePrefix = "images/ocean/";
        var directions  = ["right", "left", "top", "bottom", "front", "back"];
        var imageSuffix = ".png";
        var skyGeometry = new THREE.CubeGeometry( 5000, 5000, 5000 ); 
        var materialArray = [];
        for (var i = 0; i < 6; i++)
          materialArray.push( new THREE.MeshBasicMaterial({
          map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
          side: THREE.BackSide
        }));
        var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
        var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
        scene.add( skyBox );        

 
        // RENDERER
        webglRenderer = new THREE.WebGLRenderer();
        webglRenderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
        webglRenderer.domElement.style.position = "relative";
 
        container.appendChild(webglRenderer.domElement);
 
        var loader = new THREE.JSONLoader(),
        callbackKey = function(geometry) {createScene(geometry,  0, 0, 0, 220, "textures/WOOD.jpg")};
        loader.load("TUNA.js", callbackKey);
        
        callbackKey = function(geometry) {createScene(geometry, 0, 0, 0, 1, "baby/tex/Flesh.jpg")};
        loader.load("baby/baby.js", callbackKey);
        // var onProgress = function ( xhr ) {
        //   if ( xhr.lengthComputable ) {
        //     var percentComplete = xhr.loaded / xhr.total * 100;
        //     console.log( Math.round(percentComplete, 2) + '% downloaded' );
        //   }
        // };

        // var onError = function ( xhr ) {
        // };

        // THREE.Loader.Handlers.add( /\.dds$/i, new THREE.DDSLoader() );
        // var mtlLoader = new THREE.OBJMTLLoader();
        // mtlLoader.load( 'Trees/Tree2/Palm-Tree-01.obj', 'Trees/Tree2/Palm-Tree-01.mtl', function ( object ) {
        //   object.position.set(0,0,0);
        //   object.scale.set(20,20,20);
        //   scene.add( object );

        // }, onProgress, onError );

        document.addEventListener( 'mousemove', onDocumentMouseMove, false ); 
        window.addEventListener('resize', onWindowResize, false);
 
      }
 
      function createScene(geometry, x, y, z, scale, tmap) {
        zmesh = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({map: THREE.ImageUtils.loadTexture(tmap)}));
        zmesh.position.set(x, y, z);
        zmesh.scale.set(scale, scale, scale);
        zmesh.geometry.dynamic = true;
        meshes.push(zmesh);
        scene.add(zmesh);
      }
 
      function onWindowResize() {
 
        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;
 
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        webglRenderer.setSize(window.innerWidth, window.innerHeight);
      }
 
      function animate() {
        for(var i = 0; i < meshes.length; i++){
          meshes[i].rotation.y += .01;
          var geometry = meshes[i].geometry;
          var inc = 1375;
          for (k = 0; k < (2016-inc); k++){
            rotation += val;
            var v1 = geometry.vertices[k];
            v1.x += Math.sin(rotation) / 380;
            var v2 = geometry.vertices[k + inc];
            v2.x += Math.sin(rotation) / 380;
          }
          geometry.verticesNeedUpdate = true;
        }
        requestAnimationFrame(animate);
        render();
      }
 
      function render() {
        camera.position.x += ( mouseX - camera.position.x ) * .05;
        camera.position.y += ( - mouseY - camera.position.y ) * .05;
        camera.lookAt(scene.position);
        webglRenderer.render(scene, camera);
      }

      function onDocumentMouseMove( event ) {

        mouseX = ( event.clientX - windowHalfX ) / 2;
        mouseY = ( event.clientY - windowHalfY ) / 2;
    
      }
    </script>

    <script>
      window.onload = function () { playSound() };
    </script>
 
  </body>
</html>